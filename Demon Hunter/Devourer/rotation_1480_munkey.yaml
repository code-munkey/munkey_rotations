version: 1
spec: 1480
name: Le Vour
description: "Devour this"
entry: main

movement_allowed: true

config:

variables:
  void_meta_stacks: buff.1225789.stack
  nearby_fragments: buff.soul_fragments.stack
  in_meta: buff.1217607.up
  max_stacks: 50-(talent.soul_glutton.enabled*15)
  stacks_needed_for_meta: var.max_stacks-var.void_meta_stacks
lists:
  in_meta:
    - collapsing_star,ignore_movement=false
    - void_ray,if=fury.deficit<=10,global_delay=150
    #- void_ray,if=fury.deficit<=10|(cooldown.cull.charges=0|buff.452412.down),global_delay=150
    - cull,if=var.nearby_fragments>=4
    - reapers_toll
    - vengeful_retreat,if=buff.voidstep.up,delay=100
    - pierce_the_veil,if=lastcast.pierce_the_veil>30
    - predators_wake
    - void_ray
    - devour,ignore_movement=true
  out_of_meta:
    - void_ray,if=var.stacks_needed_for_meta=0&!state.cds&fury.deficit<10
    - reap,if=(var.void_meta_stacks>=(var.max_stacks-4)&var.nearby_fragments>=var.stacks_needed_for_meta)|(cooldown.reap.charges=cooldown.reap.max_charges&var.nearby_fragments>=var.stacks_needed_for_meta)|(cooldown.reap.charges=cooldown.reap.max_charges&var.nearby_fragments>=4)
    - consume,ignore_movement=true
  enter_meta:
    - voidblade
    - the_hunt,global_delay=100
    - trinket_1,if=trinket_1.usable&trinket_1.ready
    - trinket_2,if=trinket_2.usable&trinket_2.ready
    - void_metamorphosis
  main:
    - return,if=!state.rotation|mounted|state.state.blocked_inputs
    - call_action_list,name=sanity_checks
    - call_action_list,name=spell_queue
    - call_action_list,name=auto_heal
    - call_action_list,name=auto_target
    - call_action_list,name=enter_meta,if=!var.in_meta&var.void_meta_stacks>=var.max_stacks&state.cds
    - call_action_list,name=in_meta,if=var.in_meta
    - call_action_list,name=out_of_meta
    